# blockchain - 用 rust 构建区块链(Bitcoin)

原作者 - Github链接，包含文档和全部代码：[https://github.com/yunwei37/blockchain-rust](https://github.com/yunwei37/blockchain-rust)

区块链是 21 世纪最具革命性的技术之一，尽管区块链的热潮已经褪去，但不可否认的是它确实有其存在的意义和价值：区块链的本质是一个分布式记账和存储系统，一种无法被篡改的数据结构，它也应当会成为未来在金融和政治方面的某种信息基础设施之一。当然，肯定和各种空气币无关；目前我们所提出来的大多数应用也只是一个比较的设想而已，它的应用并没有那么广泛。

作为一个强调安全性的语言，Rust 和区块链的应用方向是十分契合的，也可以看到越来越多的区块链项目使用 Rust 进行开发。本文将使用 Rust 构建一个简单的区块链模型，并基于它来构建一个简化版的加密货币（参考比特币的实现），以供学习之用。

----- 工作量证明算法 -----

## 基本原型

区块链本质上是一个有着特定结构的数据库，是一个有序，每一个块都连接到前一个块的链表，只是采用哈希值取代了指针进行链接，通过在每个区块中间保存上一个区块的哈希值，就可以保证链条中间的某一个区块不会被篡改。

在初始情况下需要一个创世块。

在区块链中，真正存储有效信息的是区块（block），这里是个简单的定义: 

```rs
/// Block keeps block headers
#[derive(Debug)]
pub struct Block {
    timestamp: u128,
    data: String,
    prev_block_hash: String,
    hash: String,
    nonce: i32,
}
```

参数：

- Timestamp 当前时间戳，也就是区块创建的时间
- data 区块存储的实际有效信息，也就是交易
- prev_block_hash 前一个块的哈希，即父哈希
- hash 当前块的哈希
- nonce 区块nonce, 为了防⽌交易重播，ETH节点要求每笔交易必须有⼀个nonce数值


## 工作量证明：

从分布式系统的角度上来讲，每个主机都可能自行往区块链中添加区块，如何协调一致性和保证系统不会被攻击就是一个大问题。

比特币采用的是 PoW 算法，要让一个人必须经过一系列困难的工作，才能将数据放入到区块链中，完成这个工作的人，也会获得相应奖励（这也就是通过挖矿获得币）。并不只有这个算法有效，具体关于分布式的内容，可以参考后面的网络部分。

步骤：

1. 取一些公开的数据（比如，如果是 email 的话，它可以是接收者的邮件地址；在比特币中，它是区块头）；
2. 给这个公开数据添加一个 nonce，nonce 默认从 0 开始；
3. 将 data(数据) 和 nonce(计数器) 组合到一起，获得一个哈希；
4. 检查哈希是否符合一定的条件：
    - 如果符合条件，结束；
    - 如果不符合，增加计数器，重复步骤 3-4。